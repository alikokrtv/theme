{%- unless section.settings.full_width -%}
  {%- render 'section-spacing-collapsing' -%}
{%- endunless -%}

<style>
  #shopify-section-{{ section.id }} {
    {%- if section.settings.full_width -%}
      --section-outer-spacing-block: 0;
    {%- endif -%}

    --content-over-media-overlay: {{ section.settings.overlay_color.rgb }} / {{ section.settings.overlay_opacity | divided_by: 100.0 }};

    {%- if section.settings.allow_transparent_header -%}
      margin-block-start: calc(-1 * var(--header-height) * var(--section-is-first));
    {%- endif -%}
  }
</style>

<div {% render 'section-properties' %} {% if section.settings.allow_transparent_header %}allow-transparent-header{% endif %}>
  {%- capture class -%}
    content-over-media content-over-media--{{ section.settings.image_size }} 
    {% if section.settings.full_width %}full-bleed{% else %}shadow-block rounded-lg{% endif %}
  {%- endcapture -%}

  <image-banner reveal-on-scroll="true" {% if section.settings.enable_parallax %}parallax="0.3"{% endif %} {% render 'surface', class: class, text_color: section.settings.text_color %}>
    {%- if section.settings.image != blank -%}
      {%- capture sizes -%}
        {% if section.settings.full_width %}
          100vw
        {% else %}
          (max-width: 740px) calc(100vw - 40px), 
          (max-width: 999px) calc(100vw - 64px), 
          min({{ settings.page_width }}px, 100vw - 96px)
        {% endif %}
      {%- endcapture -%}
      {%- capture fetch_priority -%}{% if section.index == 1 %}high{% else %}low{% endif %}{%- endcapture -%}

      <picture>
        {%- if section.settings.mobile_image != blank -%}
          <source
            media="(max-width: 699px)"
            srcset="{{ section.settings.mobile_image | image_url: width: 400 }} 400w, 
                    {{ section.settings.mobile_image | image_url: width: 600 }} 600w, 
                    {{ section.settings.mobile_image | image_url: width: 800 }} 800w, 
                    {{ section.settings.mobile_image | image_url: width: 1000 }} 1000w, 
                    {{ section.settings.mobile_image | image_url: width: 1200 }} 1200w"
            width="{{ section.settings.mobile_image.width }}"
            height="{{ section.settings.mobile_image.height }}"
          >
        {%- endif -%}

        {{- section.settings.image | image_url: width: section.settings.image.width 
          | image_tag: sizes: sizes, fetchpriority: fetch_priority, 
          widths: '200,300,400,500,600,700,800,900,1000,1200,1400,1600,1800,2000,2200,2400,2600,2800,3000,3200' -}}
      </picture>
    {%- else -%}
      {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder' | replace: '<svg', '<svg preserveAspectRatio="xMinYMin slice"' }}
    {%- endif -%}

  </image-banner>

{%- if section.settings.show_marquee -%}
  <div class="icon-marquee w-full overflow-hidden">
    <div class="marquee flex items-center gap-12 whitespace-nowrap py-4">
      {% for block in section.blocks %}
        {% if block.type == 'marquee_item' %}
          <div class="flex items-center gap-2 flex-shrink-0">
            {% if block.settings.icon != blank %}
              <img src="{{ block.settings.icon | image_url: width: 64 }}" alt="icon" class="w-6 h-6"/>
            {% endif %}
            <span class="text-base font-medium" style="color: {{ section.settings.text_color }}">
              {{ block.settings.text }}
            </span>
          </div>
        {% endif %}
      {% endfor %}

      {# ikinci kopya: sonsuz akış için #}
      {% for block in section.blocks %}
        {% if block.type == 'marquee_item' %}
          <div class="flex items-center gap-2 flex-shrink-0">
            {% if block.settings.icon != blank %}
              <img src="{{ block.settings.icon | image_url: width: 64 }}" alt="icon" class="w-6 h-6"/>
            {% endif %}
            <span class="text-base font-medium" style="color: {{ section.settings.text_color }}">
              {{ block.settings.text }}
            </span>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{%- endif -%}

</div>

<style>
  #shopify-section-{{ section.id }} .icon-marquee {
    background-color: rgba(255,255,255,0.2);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  #shopify-section-{{ section.id }} .marquee {
    display: flex;
    animation: marquee {{ section.settings.marquee_speed }}s linear infinite;
  }
  @keyframes marquee {
    0%   { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
</style>

{% schema %}
{
  "name": "Image + Marquee",
  "class": "shopify-section--image-with-text-overlay",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "max_blocks": 15,
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width", "default": true },
    { "type": "checkbox", "id": "allow_transparent_header", "label": "Allow transparent header", "default": false },
    { "type": "checkbox", "id": "enable_parallax", "label": "Enable parallax effect", "default": false },
    {
      "type": "select",
      "id": "image_size",
      "label": "Image size",
      "options": [
        { "value": "auto", "label": "Original image ratio" },
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "fill", "label": "Fill screen" }
      ],
      "default": "auto"
    },
    { "type": "image_picker", "id": "image", "label": "Image" },
    { "type": "image_picker", "id": "mobile_image", "label": "Mobile image" },
    {
      "type": "select",
      "id": "mobile_text_position",
      "label": "Mobile content position",
      "options": [
        { "value": "place-self-start text-start", "label": "Top left" },
        { "value": "place-self-start-center text-center", "label": "Top center" },
        { "value": "place-self-start-end text-end", "label": "Top right" },
        { "value": "place-self-center-start text-start", "label": "Middle left" },
        { "value": "place-self-center text-center", "label": "Middle center" },
        { "value": "place-self-center-end text-end", "label": "Middle right" },
        { "value": "place-self-end-start text-start", "label": "Bottom left" },
        { "value": "place-self-end-center text-center", "label": "Bottom center" },
        { "value": "place-self-end text-end", "label": "Bottom right" }
      ],
      "default": "place-self-center text-center"
    },
    {
      "type": "select",
      "id": "desktop_text_position",
      "label": "Desktop content position",
      "options": [
        { "value": "sm:place-self-start sm:text-start", "label": "Top left" },
        { "value": "sm:place-self-start-center sm:text-center", "label": "Top center" },
        { "value": "sm:place-self-start-end sm:text-end", "label": "Top right" },
        { "value": "sm:place-self-center-start sm:text-start", "label": "Middle left" },
        { "value": "sm:place-self-center sm:text-center", "label": "Middle center" },
        { "value": "sm:place-self-center-end sm:text-end", "label": "Middle right" },
        { "value": "sm:place-self-end-start sm:text-start", "label": "Bottom left" },
        { "value": "sm:place-self-end-center sm:text-center", "label": "Bottom center" },
        { "value": "sm:place-self-end sm:text-end", "label": "Bottom right" }
      ],
      "default": "sm:place-self-center sm:text-center"
    },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#ffffff" },
    { "type": "color", "id": "overlay_color", "label": "Overlay", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 100, "step": 1, "default": 30 },
    { "type": "checkbox", "id": "show_marquee", "label": "Show Icon Marquee", "default": true },
    { "type": "range", "id": "marquee_speed", "label": "Marquee Speed (seconds)", "default": 30, "min": 10, "max": 60, "step": 5 }
  ],
  "blocks": [
    { "type": "subheading", "name": "Subheading", "settings": [ { "type": "text", "id": "text", "label": "Text", "default": "Subheading" } ] },
    {
      "type": "heading",
      "name": "Heading",
      "settings": [
        { "type": "text", "id": "text", "label": "Text", "default": "Heading" },
        {
          "type": "select",
          "id": "heading_tag",
          "label": "Style",
          "options": [
            { "value": "h0", "label": "XX-Large" },
            { "value": "h1", "label": "X-Large" },
            { "value": "h2", "label": "Large" },
            { "value": "h3", "label": "Medium" },
            { "value": "h4", "label": "Small" },
            { "value": "h5", "label": "X-Small" },
            { "value": "h6", "label": "XX-Small" }
          ],
          "default": "h1"
        }
      ]
    },
    { "type": "richtext", "name": "Paragraph", "settings": [ { "type": "richtext", "id": "content", "label": "Content", "default": "<p>Use this text...</p>" } ] },
    { "type": "liquid", "name": "Liquid", "settings": [ { "type": "liquid", "id": "liquid", "label": "Liquid", "default": "<p>Use this text...</p>" } ] },
    {
      "type": "button",
      "name": "Button",
      "settings": [
        { "type": "select", "id": "style", "label": "Style", "options": [ { "value": "outline", "label": "Outline" }, { "value": "fill", "label": "Fill" } ], "default": "fill" },
        { "type": "select", "id": "size", "label": "Size", "options": [ { "value": "sm", "label": "Small" }, { "value": "base", "label": "Medium" }, { "value": "lg", "label": "Large" }, { "value": "xl", "label": "X-Large" } ], "default": "lg" },
        { "type": "text", "id": "text", "label": "Text", "default": "Button text" },
        { "type": "url", "id": "url", "label": "Link" },
        { "type": "color", "id": "background", "label": "Background" },
        { "type": "color", "id": "text_color", "label": "Text" }
      ]
    },
    {
      "type": "marquee_item",
      "name": "Marquee Item",
      "settings": [
        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "text", "id": "text", "label": "Text", "default": "Super Fast Charging" }
      ]
    }
  ],
  "presets": [
    { "name": "Image with text overlay + marquee", "category": "Banners" }
  ]
}
{% endschema %}
